<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playwright POM Generator - Create Page Objects</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [pages, setPages] = useState([]);
            const [pageName, setPageName] = useState('');
            const [pageUrl, setPageUrl] = useState('');
            const [baseUrl, setBaseUrl] = useState('https://demo.playwright.dev/todomvc');
            const [generatedFiles, setGeneratedFiles] = useState({});
            const [activeTab, setActiveTab] = useState('pageObjects');
            const [showOutput, setShowOutput] = useState(false);
            const [selectedPageForView, setSelectedPageForView] = useState(null);

            useEffect(() => {
                if (showOutput && Object.keys(generatedFiles).length > 0) {
                    document.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                }
            }, [showOutput, generatedFiles, selectedPageForView]);

            const validatePageName = (name) => {
                if (!name || name.trim().length === 0) {
                    return { valid: false, error: 'Page name is required' };
                }
                if (!/^[A-Z][a-zA-Z0-9]*$/.test(name)) {
                    return { valid: false, error: 'Page name must start with capital letter and contain only alphanumeric characters' };
                }
                if (!name.endsWith('Page')) {
                    return { valid: false, error: 'Page name should end with "Page" (e.g., LoginPage)' };
                }
                return { valid: true };
            };

            const addPage = () => {
                const validation = validatePageName(pageName);
                if (!validation.valid) {
                    alert(validation.error);
                    return;
                }
                setPages([...pages, { name: pageName, url: pageUrl }]);
                setPageName('');
                setPageUrl('');
            };

            const removePage = (index) => {
                setPages(pages.filter((_, i) => i !== index));
            };

            const generateSamplePageObject = (page) => {
                return `import { Page, Locator } from '@playwright/test';

export class ${page.name} {
    readonly page: Page;
    
    // TODO: Replace these sample locators with your actual page elements
    private usernameInput = '#username';
    private passwordInput = '#password';
    private submitButton = 'button[type="submit"]';
    private errorMessage = '.error-message';
    
    constructor(page: Page) {
        this.page = page;
    }
${page.url ? `
    async navigate(): Promise<void> {
        await this.page.goto('${page.url}');
    }
` : ''}
    // Sample getter methods - customize these for your page
    async getUsernameInput(): Promise<Locator> {
        return this.page.locator(this.usernameInput);
    }

    async getPasswordInput(): Promise<Locator> {
        return this.page.locator(this.passwordInput);
    }

    async getSubmitButton(): Promise<Locator> {
        return this.page.locator(this.submitButton);
    }

    async getErrorMessage(): Promise<Locator> {
        return this.page.locator(this.errorMessage);
    }

    // Sample action methods - customize these for your page
    async fillUsername(username: string): Promise<void> {
        await (await this.getUsernameInput()).fill(username);
    }

    async fillPassword(password: string): Promise<void> {
        await (await this.getPasswordInput()).fill(password);
    }

    async clickSubmit(): Promise<void> {
        await (await this.getSubmitButton()).click();
    }

    async getErrorText(): Promise<string> {
        return await (await this.getErrorMessage()).textContent() || '';
    }

    async waitForPageLoad(): Promise<void> {
        await this.page.waitForLoadState('networkidle');
    }

    async isVisible(selector: string): Promise<boolean> {
        return await this.page.locator(selector).isVisible();
    }
}`;
            };

            const generateTestFile = (page) => {
                return `import { test, expect, Page } from '@playwright/test';
import { ${page.name} } from '../pages/${page.name}';

test.describe('${page.name} Tests', () => {
    let pageObject: ${page.name};

    test.beforeEach(async ({ page }: { page: Page }) => {
        pageObject = new ${page.name}(page);
        ${page.url ? `await pageObject.navigate();` : `await page.goto('${baseUrl}');`}
        await pageObject.waitForPageLoad();
    });

    test.afterEach(async ({ page }: { page: Page }) => {
        // Cleanup after each test
        console.log('Test completed, cleaning up...');
    });

    test('should load ${page.name} successfully', async ({ page }: { page: Page }) => {
        await expect(page).toHaveURL(/./);
        await expect(page).toHaveTitle(/./);
    });

    // TODO: Replace with your actual test scenarios
    test('sample test - customize this', async ({ page }: { page: Page }) => {
        // Example: Test form submission
        await pageObject.fillUsername('testuser');
        await pageObject.fillPassword('testpass');
        await pageObject.clickSubmit();
        await pageObject.waitForPageLoad();
    });

    test('sample validation test - customize this', async ({ page }: { page: Page }) => {
        const usernameInput = await pageObject.getUsernameInput();
        await expect(usernameInput).toBeVisible();
        
        const submitButton = await pageObject.getSubmitButton();
        await expect(submitButton).toBeEnabled();
    });
});`;
            };

            const generatePOM = () => {
                if (pages.length === 0) {
                    alert('Please add at least one page');
                    return;
                }

                const files = {};

                pages.forEach(page => {
                    files[`pages/${page.name}.ts`] = generateSamplePageObject(page);
                    files[`tests/${page.name.toLowerCase()}.spec.ts`] = generateTestFile(page);
                });

                // Generate config files
                files['playwright.config.ts'] = `import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
    testDir: './tests',
    fullyParallel: true,
    forbidOnly: !!process.env.CI,
    retries: process.env.CI ? 2 : 0,
    workers: process.env.CI ? 1 : undefined,
    reporter: [
        ['html'],
        ['json', { outputFile: 'test-results/results.json' }],
        ['list']
    ],
    use: {
        baseURL: '${baseUrl}',
        trace: 'on-first-retry',
        screenshot: 'only-on-failure',
        video: 'retain-on-failure',
        headless: true,
        viewport: { width: 1280, height: 720 },
        ignoreHTTPSErrors: true,
        actionTimeout: 10000,
    },
    projects: [
        {
            name: 'chromium',
            use: { ...devices['Desktop Chrome'] },
        },
        {
            name: 'firefox',
            use: { ...devices['Desktop Firefox'] },
        },
        {
            name: 'webkit',
            use: { ...devices['Desktop Safari'] },
        },
        {
            name: 'Mobile Chrome',
            use: { ...devices['Pixel 5'] },
        },
        {
            name: 'Mobile Safari',
            use: { ...devices['iPhone 12'] },
        },
    ],
});`;

                files['package.json'] = JSON.stringify({
                    "name": "playwright-pom-framework",
                    "version": "1.0.0",
                    "description": "Playwright test automation framework with Page Object Model",
                    "scripts": {
                        "test": "playwright test",
                        "test:headed": "playwright test --headed",
                        "test:debug": "playwright test --debug",
                        "test:ui": "playwright test --ui",
                        "report": "playwright show-report"
                    },
                    "keywords": ["playwright", "testing", "automation", "pom", "typescript"],
                    "author": "Hari Prasad MS",
                    "license": "MIT",
                    "devDependencies": {
                        "@playwright/test": "^1.41.0",
                        "@types/node": "^20.11.0",
                        "typescript": "^5.3.0"
                    }
                }, null, 2);

                files['tsconfig.json'] = JSON.stringify({
                    "compilerOptions": {
                        "target": "ES2020",
                        "module": "commonjs",
                        "lib": ["ES2020"],
                        "strict": true,
                        "esModuleInterop": true,
                        "skipLibCheck": true,
                        "types": ["node", "@playwright/test"]
                    },
                    "include": ["tests/**/*", "pages/**/*"]
                }, null, 2);

                files['README.md'] = `# Playwright POM Framework

## üìã Overview
Generated Playwright test framework with Page Object Model pattern.

**Base URL:** ${baseUrl}

## üöÄ Quick Start

\`\`\`bash
npm install
npx playwright install
npm test
\`\`\`

## üìù Customization Guide

The generated files contain sample code with TODO comments. Follow these steps:

1. **Update Page Objects** (\`pages/*.ts\`):
   - Replace sample locators with your actual page elements
   - Add/remove getter methods as needed
   - Customize action methods for your use case

2. **Update Tests** (\`tests/*.spec.ts\`):
   - Replace sample tests with your actual test scenarios
   - Update test data and assertions

3. **Configuration** (\`playwright.config.ts\`):
   - Adjust browser settings if needed
   - Update baseURL if required

## üìÅ Structure

\`\`\`
‚îú‚îÄ‚îÄ pages/              # Page Object Models (customize these!)
‚îú‚îÄ‚îÄ tests/              # Test specifications (customize these!)
‚îú‚îÄ‚îÄ playwright.config.ts
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ tsconfig.json
\`\`\`

---
Generated by [Playwright POM Generator](https://hariprasadms.github.io/pomtestbuilder/)
`;

                files['.gitignore'] = `node_modules/
test-results/
playwright-report/
playwright/.cache/
dist/
.env
*.log
package-lock.json`;

                setGeneratedFiles(files);
                setShowOutput(true);
                setSelectedPageForView(null);

                setTimeout(() => {
                    const outputElement = document.getElementById('output-section');
                    if (outputElement) {
                        outputElement.scrollIntoView({ behavior: 'smooth' });
                    }
                }, 100);
            };

            const downloadFile = (filename) => {
                const blob = new Blob([generatedFiles[filename]], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename.split('/').pop();
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            const downloadAllFiles = async () => {
                const zip = new JSZip();
                Object.entries(generatedFiles).forEach(([name, content]) => {
                    zip.file(name, content);
                });
                const blob = await zip.generateAsync({ type: 'blob' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'playwright-framework.zip';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-600 to-indigo-700">
                    {/* Header */}
                    <header className="bg-white shadow-md sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex flex-wrap justify-between items-center gap-4">
                            <div className="flex items-center gap-4">
                                <a href="./" className="text-purple-700 hover:text-purple-900 transition font-medium">
                                    ‚Üê Home
                                </a>
                                <h1 className="text-2xl font-bold text-purple-700">üé≠ POM Generator</h1>
                            </div>
                            <nav className="flex gap-6">
                                <a href="https://playwright.dev/docs/pom" target="_blank" rel="noopener noreferrer" className="text-purple-700 hover:text-purple-900 font-medium transition hover:underline">
                                    üìö Docs
                                </a>
                                <a href="https://hariprasadms.github.io/" target="_blank" rel="noopener noreferrer" className="text-purple-700 hover:text-purple-900 font-medium transition hover:underline">
                                    üë§ About
                                </a>
                            </nav>
                        </div>
                    </header>

                    <div className="p-6">
                        <div className="max-w-6xl mx-auto bg-white rounded-xl shadow-2xl">
                            <div className="bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-8 text-center">
                                <h2 className="text-3xl font-bold mb-2">Generate Page Object Models</h2>
                                <p className="text-purple-100">Create TypeScript page objects with sample code you can customize</p>
                            </div>

                            <div className="p-8">
                                {/* Base URL */}
                                <div className="mb-6 p-6 bg-blue-50 rounded-lg border-l-4 border-blue-600">
                                    <h2 className="text-2xl font-semibold text-blue-700 mb-4">üåê Application Base URL</h2>
                                    <input
                                        type="text"
                                        className="w-full p-3 border-2 border-blue-300 rounded-lg focus:border-blue-600 focus:outline-none"
                                        value={baseUrl}
                                        onChange={(e) => setBaseUrl(e.target.value)}
                                        placeholder="https://your-application.com"
                                    />
                                    <p className="text-sm text-gray-600 mt-2">This will be used in your test configuration</p>
                                </div>

                                {/* Page Configuration */}
                                <div className="mb-6 p-6 bg-gray-50 rounded-lg border-l-4 border-purple-600">
                                    <h2 className="text-2xl font-semibold text-purple-700 mb-4">üìÑ Add Pages</h2>
                                    <div className="mb-3">
                                        <label className="block mb-2 font-semibold text-gray-700">Page Name (must end with "Page")</label>
                                        <input
                                            type="text"
                                            className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-600 focus:outline-none"
                                            value={pageName}
                                            onChange={(e) => setPageName(e.target.value)}
                                            placeholder="e.g., LoginPage, HomePage, CheckoutPage"
                                        />
                                    </div>
                                    <div className="mb-3">
                                        <label className="block mb-2 font-semibold text-gray-700">Page URL (optional)</label>
                                        <input
                                            type="text"
                                            className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-600 focus:outline-none"
                                            value={pageUrl}
                                            onChange={(e) => setPageUrl(e.target.value)}
                                            placeholder="e.g., /login or https://example.com/login"
                                        />
                                    </div>
                                    <button onClick={addPage} className="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition shadow-lg transform hover:scale-105">
                                        + Add Page
                                    </button>
                                    <div className="flex flex-wrap gap-2 mt-4">
                                        {pages.map((p, i) => (
                                            <span key={i} className="bg-purple-600 text-white px-4 py-2 rounded-full flex items-center gap-2 shadow-md">
                                                {p.name}
                                                <span onClick={() => removePage(i)} className="cursor-pointer text-xl hover:text-red-200 transition">√ó</span>
                                            </span>
                                        ))}
                                    </div>
                                </div>

                                {/* Generate Buttons */}
                                <div className="mb-6 p-6 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg border-2 border-purple-300">
                                    <h2 className="text-2xl font-semibold text-purple-700 mb-4">‚ö° Generate Framework</h2>
                                    <div className="flex gap-3 flex-wrap">
                                        <button onClick={generatePOM} disabled={pages.length === 0} className="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-8 py-3 rounded-lg font-bold hover:from-purple-700 hover:to-purple-800 transition shadow-lg transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                                            üöÄ Generate POM
                                        </button>
                                        <button onClick={() => { generatePOM(); setTimeout(downloadAllFiles, 500); }} disabled={pages.length === 0} className="bg-gradient-to-r from-indigo-600 to-indigo-700 text-white px-8 py-3 rounded-lg font-bold hover:from-indigo-700 hover:to-indigo-800 transition shadow-lg transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                                            üì¶ Generate & Download ZIP
                                        </button>
                                    </div>
                                </div>

                                {/* Output Section */}
                                {showOutput && (
                                    <div id="output-section" className="mt-8">
                                        <div className="bg-gradient-to-r from-green-100 to-green-200 border-l-4 border-green-500 text-green-800 p-4 rounded-lg mb-6 shadow-md">
                                            ‚úÖ Generated {Object.keys(generatedFiles).length} files successfully! Sample code included - customize for your needs.
                                        </div>

                                        {/* Page File Viewer */}
                                        <div className="mb-6 p-6 bg-purple-50 rounded-lg border-2 border-purple-300">
                                            <h3 className="text-xl font-bold text-purple-700 mb-4">üëÅÔ∏è View Generated Page Files</h3>
                                            <div className="flex flex-wrap gap-2 mb-4">
                                                {Object.keys(generatedFiles).filter(f => f.startsWith('pages/')).map(f => (
                                                    <button
                                                        key={f}
                                                        onClick={() => setSelectedPageForView(f)}
                                                        className={`px-4 py-2 rounded-lg font-semibold transition ${selectedPageForView === f ? 'bg-purple-700 text-white' : 'bg-white text-purple-700 hover:bg-purple-100'}`}
                                                    >
                                                        {f.split('/').pop().replace('.ts', '')}
                                                    </button>
                                                ))}
                                            </div>
                                            {selectedPageForView && (
                                                <div>
                                                    <div className="flex justify-between items-center mb-2">
                                                        <h4 className="font-bold text-lg text-purple-700">{selectedPageForView}</h4>
                                                        <button onClick={() => downloadFile(selectedPageForView)} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                                                            üíæ Download
                                                        </button>
                                                    </div>
                                                    <pre className="rounded-lg overflow-hidden">
                                                        <code className="typescript">{generatedFiles[selectedPageForView]}</code>
                                                    </pre>
                                                </div>
                                            )}
                                            {!selectedPageForView && (
                                                <p className="text-gray-600 text-center py-8">Click on a page name above to view its generated code</p>
                                            )}
                                        </div>

                                        {/* Tabs for other files */}
                                        <div className="flex gap-2 mb-4 border-b-2 border-gray-200 flex-wrap">
                                            {['tests', 'config'].map(tab => (
                                                <button 
                                                    key={tab} 
                                                    onClick={() => setActiveTab(tab)} 
                                                    className={`px-6 py-3 font-semibold transition ${activeTab === tab ? 'text-purple-700 border-b-4 border-purple-700' : 'text-gray-600 hover:text-purple-600'}`}
                                                >
                                                    {tab === 'tests' && 'üß™ Tests'}
                                                    {tab === 'config' && '‚öôÔ∏è Configuration'}
                                                </button>
                                            ))}
                                        </div>

                                        {activeTab === 'tests' && (
                                            <div>
                                                {Object.keys(generatedFiles).filter(f => f.startsWith('tests')).map(f => (
                                                    <div key={f} className="mb-6">
                                                        <div className="flex justify-between items-center mb-2">
                                                            <h3 className="font-bold text-lg text-purple-700">{f}</h3>
                                                            <button onClick={() => downloadFile(f)} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                                                                üíæ Download
                                                            </button>
                                                        </div>
                                                        <pre className="rounded-lg overflow-hidden">
                                                            <code className="typescript">{generatedFiles[f]}</code>
                                                        </pre>
                                                    </div>
                                                ))}
                                            </div>
                                        )}

                                        {activeTab === 'config' && (
                                            <div>
                                                {['playwright.config.ts', 'package.json', 'tsconfig.json', 'README.md', '.gitignore'].map(f => (
                                                    generatedFiles[f] && (
                                                        <div key={f} className="mb-6">
                                                            <div className="flex justify-between items-center mb-2">
                                                                <h3 className="font-bold text-lg text-purple-700">{f}</h3>
                                                                <button onClick={() => downloadFile(f)} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                                                                    üíæ Download
                                                                </button>
                                                            </div>
                                                            <pre className="rounded-lg overflow-hidden">
                                                                <code className={f.endsWith('.json') ? 'json' : f.endsWith('.ts') ? 'typescript' : 'plaintext'}>
                                                                    {generatedFiles[f]}
                                                                </code>
                                                            </pre>
                                                        </div>
                                                    )
                                                ))}
                                            </div>
                                        )}

                                        {/* Download All */}
                                        <div className="mt-8 p-6 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg border-2 border-purple-300">
                                            <h3 className="text-xl font-semibold mb-4">üì¶ Download Complete Framework</h3>
                                            <button onClick={downloadAllFiles} className="bg-gradient-to-r from-purple-600 to-indigo-700 text-white px-8 py-4 rounded-lg font-bold text-lg hover:from-purple-700 hover:to-indigo-800 shadow-lg transition transform hover:scale-105">
                                                üì¶ Download ZIP Archive
                                            </button>
                                            <p className="mt-3 text-gray-600 text-sm">
                                                Includes: Page Objects with sample code, Tests, Config files, and README with customization guide
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
